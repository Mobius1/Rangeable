/*
 Rangeable
 Copyright (c) 2018 Karl Saunders
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.

 Version: 0.0.2

*/
var Rangeable=function(a,b){"string"===typeof a&&(a=document.querySelector(a));this.input=a;this.config=Object.assign({},{tooltip:!0,showTooltips:!0,multiple:!1,classes:{input:"ranger-input",container:"ranger-container",vertical:"ranger-vertical",progress:"ranger-progress",handle:"ranger-handle",tooltip:"ranger-tooltip",track:"ranger-track",multiple:"ranger-multiple"}},b);this.mouseAxis={x:"clientX",y:"clientY"};this.trackSize={x:"width",y:"height"};this.trackPos={x:"left",y:"top"};this.touch="ontouchstart"in
window||window.DocumentTouch&&document instanceof DocumentTouch;this.init();this.onInit()};
Rangeable.prototype.init=function(){if(!this.input.ranger){var a={min:0,max:100,step:1,value:this.input.value},b;for(b in a)this.input[b]||(this.input[b]=a[b]),void 0!==this.config[b]&&(this.input[b]=this.config[b]);this.input.defaultValue||(this.input.defaultValue=this.input.value);this.axis=this.config.vertical?"y":"x";this.input.ranger=this;this.config.multiple&&(this.input.values=[],this.config.value&&(this.input.values=this.config.value));this.render()}};
Rangeable.prototype.render=function(){var a=this.config,b=a.classes,c=this.createElement("div",b.container),d=this.createElement("div",b.track),e=this.createElement("div",b.progress),f=this.createElement("div",b.handle),g=this.createElement("div",b.tooltip);d.appendChild(e);a.multiple?(f=[this.createElement("div",b.handle),this.createElement("div",b.handle)],g=[this.createElement("div",b.tooltip),this.createElement("div",b.tooltip),this.createElement("div",b.tooltip)],f.forEach(function(a,b){a.index=
b;e.appendChild(a);a.appendChild(g[b])}),a.vertical&&e.appendChild(f[0]),e.appendChild(g[2]),c.classList.add(b.multiple)):(e.appendChild(f),f.appendChild(g));this.nodes={container:c,track:d,progress:e,handle:f,tooltip:g};c.appendChild(d);a.vertical&&c.classList.add(b.vertical);a.size&&(c.style[this.trackSize[this.axis]]=isNaN(a.size)?a.size:a.size+"px");a.tooltip&&c.classList.add("has-tooltip");a.showTooltips&&c.classList.add("show-tooltip");this.input.parentNode.insertBefore(c,this.input);c.insertBefore(this.input,
d);this.input.classList.add(b.input);this.bind();this.update()};Rangeable.prototype.reset=function(){this.setValue(this.input.defaultValue);this.onEnd()};
Rangeable.prototype.setValueFromPosition=function(a){var b=parseFloat(this.input.min),c=parseFloat(this.input.max),d=parseFloat(this.input.step),e=(this.touch?a.touches[0][this.mouseAxis[this.axis]]:a[this.mouseAxis[this.axis]])-this.rects.container[this.trackPos[this.axis]],f=this.rects.container[this.trackSize[this.axis]];b=Math.ceil(((this.config.vertical?(f-e)/f*100:e/f*100)*(c-b)/100+b)/d)*d;c=!1;if(this.config.multiple)switch(c=this.activeHandle.index,c){case 0:b>=this.input.values[1]&&(b=this.input.values[1]);
break;case 1:b<=this.input.values[0]&&(b=this.input.values[0])}"mousedown"!==a.type&&parseFloat(b)===parseFloat(this.input.value)||this.setValue(b,c)};Rangeable.prototype.change=function(){};Rangeable.prototype.touchstart=function(a){this.down(a)};
Rangeable.prototype.down=function(a){a.preventDefault();this.nodes.container.classList.add("dragging");this.recalculate();this.activeHandle=this.getHandle(a);this.activeHandle.classList.add("active");this.setValueFromPosition(a);this.touch?(document.addEventListener("touchmove",this.listeners.move,!1),document.addEventListener("touchend",this.listeners.up,!1),document.addEventListener("touchcancel",this.listeners.up,!1)):(document.addEventListener("mousemove",this.listeners.move,!1),document.addEventListener("mouseup",
this.listeners.up,!1))};Rangeable.prototype.move=function(a){this.setValueFromPosition(a);this.input.dispatchEvent(new Event("input"))};
Rangeable.prototype.up=function(a){this.nodes.container.classList.remove("dragging");this.onEnd();this.activeHandle.classList.remove("active");this.activeHandle=!1;document.removeEventListener("mousemove",this.listeners.move);document.removeEventListener("mouseup",this.listeners.up);document.removeEventListener("touchmove",this.listeners.move);document.removeEventListener("touchend",this.listeners.up);document.removeEventListener("touchcancel",this.listeners.up);this.input.dispatchEvent(new Event("change"))};
Rangeable.prototype.recalculate=function(){var a=[];this.config.multiple?this.nodes.handle.forEach(function(b,c){a[c]=b.getBoundingClientRect()}):a=this.nodes.handle.getBoundingClientRect();this.rects={handle:a,container:this.nodes.container.getBoundingClientRect()}};
Rangeable.prototype.update=function(){var a=this;this.recalculate();this.accuracy=0;this.input.step.includes(".")&&(this.accuracy=(this.input.step.split(".")[1]||[]).length);this.config.multiple?this.input.values.forEach(function(b,c){a.setValue(b,c)}):this.setValue()};
Rangeable.prototype.setValue=function(a,b){var c=this.nodes,d=parseFloat(this.input.min),e=parseFloat(this.input.max);if(this.config.multiple&&void 0===b)return!1;void 0===a&&(a=this.input.value);a=parseFloat(a);a=a.toFixed(this.accuracy);a<d?a=d.toFixed(this.accuracy):a>e&&(a=e.toFixed(this.accuracy));this.config.multiple?(d=this.input.values,d[b]=a,this.config.tooltip&&(c.tooltip[b].textContent=a,e=this.tipsIntersecting(),c.container.classList.toggle("combined-tooltip",e),e&&(c.tooltip[2].textContent=
d[0]===d[1]?d[0]:d[0]+" - "+d[1]))):(this.input.value=a,c.tooltip.textContent=a);this.setPosition(a,b);this.onChange()};Rangeable.prototype.setPosition=function(a){if(this.config.multiple){a=this.getPosition(this.input.values[0]);var b=this.getPosition(this.input.values[1]);this.nodes.progress.style[this.config.vertical?"bottom":"left"]=a+"px";a=b-a}else a=this.getPosition();this.nodes.progress.style[this.trackSize[this.axis]]=a+"px"};
Rangeable.prototype.getPosition=function(a){a=void 0===a?this.input.value:a;var b=parseFloat(this.input.min),c=parseFloat(this.input.max);return(a-b)/(c-b)*this.rects.container[this.trackSize[this.axis]]};Rangeable.prototype.tipsIntersecting=function(){var a=this.nodes.tooltip,b=a[0].getBoundingClientRect();a=a[1].getBoundingClientRect();return!(b.right<a.left||b.left>a.right||b.bottom<a.top||b.top>a.bottom)};
Rangeable.prototype.getHandle=function(a){if(!this.config.multiple)return this.nodes.handle;var b=this.rects,c=Math.abs(a[this.mouseAxis[this.axis]]-b.handle[0][this.trackPos[this.axis]]);b=Math.abs(a[this.mouseAxis[this.axis]]-b.handle[1][this.trackPos[this.axis]]);return(a=a.target.closest("."+this.config.classes.handle))?a:c>b?this.nodes.handle[1]:this.nodes.handle[0]};
Rangeable.prototype.destroy=function(){this.input.ranger&&(this.unbind(),this.input.classList.remove(this.config.classes.input),this.nodes.container.parentNode.replaceChild(this.input,this.nodes.container),delete this.input.ranger)};Rangeable.prototype.onInit=function(){this.isFunction(this.config.onInit)&&this.config.onInit.call(this,this.input.value)};Rangeable.prototype.onChange=function(){this.isFunction(this.config.onChange)&&this.config.onChange.call(this,this.input.value)};
Rangeable.prototype.onEnd=function(){this.isFunction(this.config.onEnd)&&this.config.onEnd.call(this,this.input.value)};
Rangeable.prototype.bind=function(){this.listeners={down:this.down.bind(this),touchstart:this.touchstart.bind(this),move:this.move.bind(this),up:this.up.bind(this),update:this.update.bind(this),change:this.change.bind(this),reset:this.reset.bind(this)};this.listeners.scroll=this.throttle(this.listeners.update,100);this.listeners.resize=this.throttle(this.listeners.update,50);document.addEventListener("scroll",this.listeners.scroll,!1);window.addEventListener("resize",this.listeners.resize,!1);this.input.addEventListener("change",
this.listeners.change,!1);this.touch?this.nodes.container.addEventListener("touchstart",this.listeners.touchstart,!1):this.nodes.container.addEventListener("mousedown",this.listeners.down);this.input.form&&this.input.form.addEventListener("reset",this.listeners.reset,!1)};
Rangeable.prototype.unbind=function(){this.touch?this.nodes.container.removeEventListener("touchstart",this.listeners.touchstart):this.nodes.container.removeEventListener("mousedown",this.listeners.down);document.removeEventListener("scroll",this.listeners.scroll);window.removeEventListener("resize",this.listeners.resize);this.input.removeEventListener("change",this.listeners.change);this.input.form&&this.input.form.removeEventListener("reset",this.listeners.reset);this.listeners=null};
Rangeable.prototype.createElement=function(a,b){var c=document.createElement(a);if("string"===typeof b)c.classList.add(b);else if(b===Object(b))for(var d in b)d in c?c[d]=b[d]:c.setAttribute(c[d],b[d]);return c};Rangeable.prototype.isFunction=function(a){return a&&"function"===typeof a};Rangeable.prototype.throttle=function(a,b,c){var d;return function(){c=c||this;if(!d)return a.apply(c,arguments),d=!0,setTimeout(function(){d=!1},b)}};